<?php

namespace Database\Seeders\Data;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use App\Models\Product;
use App\Models\PriceVariation;
use App\Models\ProductMix;

class ProductsWithRelationshipsSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Disable auto-increment temporarily to preserve IDs
        DB::statement('SET foreign_key_checks = 0');
        
        // Truncate existing data (in correct order due to foreign key constraints)
        DB::table('product_price_variations')->truncate();
        DB::table('product_mix_components')->truncate();
        DB::table('product_mixes')->truncate();
        DB::table('products')->truncate();
        
        // Seed Product Mixes first
        $productMixes = [
            [
                "id" => 9,
                "name" => "Rainbow Mix",
                "description" => null,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 10,
                "name" => "Spicy Mix",
                "description" => null,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
        ];
        
        foreach ($productMixes as $mix) {
            DB::table('product_mixes')->insert($mix);
        }
        
        // Seed Product Mix Components
        $productMixComponents = [
            [
                "product_mix_id" => 9,
                "master_seed_catalog_id" => 15,
                "percentage" => 30.00000,
                "cultivar" => "Speckled",
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "product_mix_id" => 9,
                "master_seed_catalog_id" => 17,
                "percentage" => 35.00000,
                "cultivar" => "Black Oilseed",
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "product_mix_id" => 9,
                "master_seed_catalog_id" => 16,
                "percentage" => 20.00000,
                "cultivar" => "Red",
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "product_mix_id" => 9,
                "master_seed_catalog_id" => 7,
                "percentage" => 15.00000,
                "cultivar" => "Red",
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "product_mix_id" => 10,
                "master_seed_catalog_id" => 16,
                "percentage" => 30.00000,
                "cultivar" => "Red",
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "product_mix_id" => 10,
                "master_seed_catalog_id" => 14,
                "percentage" => 30.00000,
                "cultivar" => "Oriental",
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "product_mix_id" => 10,
                "master_seed_catalog_id" => 2,
                "percentage" => 15.00000,
                "cultivar" => "Arugula",
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "product_mix_id" => 10,
                "master_seed_catalog_id" => 10,
                "percentage" => 25.00000,
                "cultivar" => "Curly (Garden )",
                "created_at" => now(),
                "updated_at" => now(),
            ],
        ];
        
        foreach ($productMixComponents as $component) {
            DB::table('product_mix_components')->insert($component);
        }
        
        // Seed Products
        $products = [
            [
                "id" => 2,
                "name" => "Sunflower Shoots",
                "description" => null,
                "sku" => null,
                "active" => true,
                "is_visible_in_store" => true,
                "category_id" => 1,
                "product_mix_id" => null,
                "master_seed_catalog_id" => 17,
                "image" => null,
                "total_stock" => 0.00,
                "reserved_stock" => 0.00,
                "reorder_threshold" => 0.00,
                "track_inventory" => true,
                "stock_status_id" => 3,
                "wholesale_discount_percentage" => 30.00,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 3,
                "name" => "Pea Shoots",
                "description" => null,
                "sku" => null,
                "active" => true,
                "is_visible_in_store" => true,
                "category_id" => 1,
                "product_mix_id" => null,
                "master_seed_catalog_id" => 15,
                "image" => null,
                "total_stock" => 0.00,
                "reserved_stock" => 0.00,
                "reorder_threshold" => 0.00,
                "track_inventory" => true,
                "stock_status_id" => 3,
                "wholesale_discount_percentage" => 30.00,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 4,
                "name" => "Broccoli",
                "description" => null,
                "sku" => null,
                "active" => true,
                "is_visible_in_store" => true,
                "category_id" => 1,
                "product_mix_id" => null,
                "master_seed_catalog_id" => 6,
                "image" => null,
                "total_stock" => 0.00,
                "reserved_stock" => 0.00,
                "reorder_threshold" => 0.00,
                "track_inventory" => true,
                "stock_status_id" => 3,
                "wholesale_discount_percentage" => 30.00,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 5,
                "name" => "Rainbow Mix",
                "description" => null,
                "sku" => null,
                "active" => true,
                "is_visible_in_store" => true,
                "category_id" => 1,
                "product_mix_id" => 9,
                "master_seed_catalog_id" => null,
                "image" => null,
                "total_stock" => 0.00,
                "reserved_stock" => 0.00,
                "reorder_threshold" => 0.00,
                "track_inventory" => true,
                "stock_status_id" => 3,
                "wholesale_discount_percentage" => 30.00,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 6,
                "name" => "Spicy Mix",
                "description" => null,
                "sku" => null,
                "active" => true,
                "is_visible_in_store" => true,
                "category_id" => 1,
                "product_mix_id" => 10,
                "master_seed_catalog_id" => null,
                "image" => null,
                "total_stock" => 0.00,
                "reserved_stock" => 0.00,
                "reorder_threshold" => 0.00,
                "track_inventory" => true,
                "stock_status_id" => 3,
                "wholesale_discount_percentage" => 30.00,
                "created_at" => now(),
                "updated_at" => now(),
            ],
        ];
        
        foreach ($products as $product) {
            DB::table('products')->insert($product);
        }
        
        // Seed Price Variations
        $priceVariations = [
            [
                "id" => 8,
                "product_id" => 2,
                "template_id" => 1,
                "packaging_type_id" => 2,
                "pricing_type" => "retail",
                "name" => "Retail - Clamshell (24oz) - $5.00",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 80.00,
                "price" => 5.00,
                "pricing_unit" => null,
                "is_default" => true,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 9,
                "product_id" => 2,
                "template_id" => 3,
                "packaging_type_id" => 2,
                "pricing_type" => "retail",
                "name" => "Wholesale - Clamshell (24oz) - $3.50",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 80.00,
                "price" => 3.50,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 10,
                "product_id" => 2,
                "template_id" => 6,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Live Tray",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => null,
                "price" => 20.00,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 11,
                "product_id" => 2,
                "template_id" => 7,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Bulk",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 453.00,
                "price" => 32.00,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 12,
                "product_id" => 3,
                "template_id" => 4,
                "packaging_type_id" => 3,
                "pricing_type" => "retail",
                "name" => "Retail - 32oz Clamshell (32oz) - $5.00",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 70.00,
                "price" => 5.00,
                "pricing_unit" => null,
                "is_default" => true,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 13,
                "product_id" => 3,
                "template_id" => 5,
                "packaging_type_id" => null,
                "pricing_type" => "wholesale",
                "name" => "Wholesale - Package-Free - $0.20",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 70.00,
                "price" => 0.20,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 14,
                "product_id" => 3,
                "template_id" => 6,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Live Tray",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => null,
                "price" => 20.00,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 15,
                "product_id" => 3,
                "template_id" => 7,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Package-Free - $18.00",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 453.00,
                "price" => 18.00,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 16,
                "product_id" => 4,
                "template_id" => 1,
                "packaging_type_id" => 2,
                "pricing_type" => "retail",
                "name" => "Retail - Clamshell (24oz) - $5.00",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 60.00,
                "price" => 5.00,
                "pricing_unit" => null,
                "is_default" => true,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 17,
                "product_id" => 4,
                "template_id" => 3,
                "packaging_type_id" => 2,
                "pricing_type" => "retail",
                "name" => "Wholesale - Clamshell (24oz) - $3.50",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 60.00,
                "price" => 3.50,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 18,
                "product_id" => 4,
                "template_id" => 6,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Live Tray - $35.00",
                "is_name_manual" => true,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 1.00,
                "price" => 35.00,
                "pricing_unit" => "per_item",
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 19,
                "product_id" => 4,
                "template_id" => 7,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Package-Free - $35.00",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 453.00,
                "price" => 35.00,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 20,
                "product_id" => 5,
                "template_id" => 1,
                "packaging_type_id" => 2,
                "pricing_type" => "retail",
                "name" => "Retail - 24 oz - $5.00",
                "is_name_manual" => true,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 70.00,
                "price" => 5.00,
                "pricing_unit" => null,
                "is_default" => true,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 21,
                "product_id" => 5,
                "template_id" => 3,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Wholesale",
                "is_name_manual" => true,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 453.00,
                "price" => 35.00,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 22,
                "product_id" => 5,
                "template_id" => 6,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Bulk",
                "is_name_manual" => true,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 453.00,
                "price" => 25.00,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 23,
                "product_id" => 5,
                "template_id" => 7,
                "packaging_type_id" => 2,
                "pricing_type" => "wholesale",
                "name" => "Wholesale - 24 oz - $3.50",
                "is_name_manual" => true,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 70.00,
                "price" => 3.50,
                "pricing_unit" => "per_item",
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 24,
                "product_id" => 6,
                "template_id" => 1,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Bulk",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 60.00,
                "price" => 0.20,
                "pricing_unit" => null,
                "is_default" => true,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 25,
                "product_id" => 6,
                "template_id" => 3,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Bulk",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 60.00,
                "price" => 0.20,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
            [
                "id" => 26,
                "product_id" => 6,
                "template_id" => 7,
                "packaging_type_id" => null,
                "pricing_type" => "retail",
                "name" => "Retail - Bulk",
                "is_name_manual" => false,
                "unit" => "units",
                "sku" => null,
                "fill_weight" => 453.00,
                "price" => 35.00,
                "pricing_unit" => null,
                "is_default" => false,
                "is_global" => false,
                "is_active" => true,
                "created_at" => now(),
                "updated_at" => now(),
            ],
        ];
        
        foreach ($priceVariations as $variation) {
            DB::table('product_price_variations')->insert($variation);
        }
        
        // Re-enable foreign key checks
        DB::statement('SET foreign_key_checks = 1');
        
        $this->command->info('Products, product mixes, and price variations seeded successfully with preserved IDs!');
    }
}